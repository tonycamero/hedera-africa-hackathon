// Fairfield Voice - Prisma Schema
// PII + operational data only (civic signals go to HCS)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String   @id @default(cuid())
  issuer     String   @unique  // Magic DID
  email      String?  @unique
  ward       String?           // e.g., "W-3"
  emailOptIn Boolean  @default(false)
  
  // NEW: Contact directory features
  displayName    String?          // "Alex C." or "Alex Chen"
  directoryOptIn Boolean @default(false)
  
  createdAt  DateTime @default(now())
}

model Invite {
  slug       String   @id       // operational convenience for share URL/QR
  inviterDid String              // issuer of inviter
  ward       String
  maxUses    Int      @default(1)
  createdAt  DateTime @default(now())
}

model Event {
  id         String   @id @default(cuid())
  title      String
  startsAt   DateTime
  location   String
  details    String?
  createdAt  DateTime @default(now())
}

model ConsentLog {
  id         String   @id @default(cuid())
  issuer     String
  channel    String   // "sms"
  action     String   // "opt_in" | "opt_out" | "help"
  ts         DateTime @default(now())
}
